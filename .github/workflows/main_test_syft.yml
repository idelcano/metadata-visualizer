name: Runner Smoke + Syft SBOM 2

on:
  workflow_dispatch:

jobs:
  smoke:
    runs-on: bom
    steps:
      - uses: actions/checkout@v4
      - name: Read node version
        id: nodever
        run: echo "NODE_VERSION=$(tr -d 'v' < .nvmrc)" >> "$GITHUB_ENV"
        
      - name: Yarn install + SBOM (container)
        run: |
          podman run --rm \
          -v "$GITHUB_WORKSPACE:/work" -w /work \
          node:${NODE_VERSION}-bullseye \
          bash -lc "corepack enable && yarn install && syft . -o cyclonedx-json=sbom.json"

      - name: Upload SBOM
        uses: actions/upload-artifact@v4
        with:
          name: sbom
          path: sbom.json
